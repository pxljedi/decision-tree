/*
 * Decision Tree jQuery plugin.
 * Author: Dan Smith, 2015 (http://www.dbswebdev.com/)
 * Version: 1.0.0
 */
!function(e){e.decisionTree=function(t,i){var n={data_folder:"",node_prefix:"dtn",json_ext:"json",cache_json:!0,loading_text:"Loading...",loading_gif:"/decisionTree/img/loading.gif",animation_speed:600,question_extra_text:!0,hide_original_content:!0,answer_link:!0,answer_target:"_blank"},s=this;s.settings={};var t=(e(t),t);s.init=function(){if(s.settings=e.extend({},n,i),!document.getElementById("decision-tree-loading")){var t=document.createElement("div"),a=document.createElement("p"),d=document.createTextNode(s.settings.loading_text),o=document.createElement("br"),r=document.createElement("img");t.id="decision-tree-loading",r.setAttribute("src",s.settings.loading_gif),a.appendChild(r),a.appendChild(o),a.appendChild(d),t.appendChild(a),document.body.appendChild(t)}e(document).ajaxStart(function(){e("#decision-tree-loading").show(s.settings.animation_speed)}).ajaxStop(function(){e("#decision-tree-loading").hide(s.settings.animation_speed)})},s.init()},e.fn.decisionTree=function(t){return this.each(function(){if(void 0==e(this).data("decisionTree")){var i=new e.decisionTree(this,t);e(this).data("decisionTree",i)}var n=e(this).find(".cta a").attr("data-start-node"),s=i.settings.data_folder+n+"."+i.settings.json_ext,a=[n];e(this).find(".cta a").on("click",function(t){var o=e(this).parent().parent();t.preventDefault(),i.settings.hide_original_content?e(o).children().slideUp(i.settings.animation_speed,function(){e(this).remove()}):(e(this).off(),e(this).parent().addClass("clicked"),e(this).on("click",function(t){for(t.preventDefault();n!==a[a.length-1];){var s=a.pop();e("#"+s).slideDown(i.settings.animation_speed,function(){e("#"+s).remove()})}e("#"+a[0]+" ul li").removeClass("ticked"),e("#"+a[0]).removeClass("done").addClass("active")})),e.ajax(s,{cache:i.settings.cache_json,success:function(t){var n="",s="";i.settings.question_extra_text&&void 0!==t.description&&(s="<p>"+t.description+"</p>");for(var d=0,r=t.answers.length;r>d;d++)n+="<li><a href='#"+t.answers[d].target+"' aria-selected='false'>"+t.answers[d].text+"</li>";e(o).prepend("<div id='"+a[0]+"' class='startNode dtNode active'><h3>"+t.question+"</h3>"+s+"<ul>"+n+"</ul></div>")},error:function(){alert("Couldn't retrieve data file: "+s)}}),e(o).on("click","ul li a",function(t){t.preventDefault();var n,s,r,l=e(this).attr("href").substring(1),c=d(),g=RegExp("^"+i.settings.node_prefix+".*"),h=e(this).closest(".dtNode").attr("id");for(n=l.match(g),e(this).closest(".dtNode").find("ul li").removeClass("ticked"),e(this).closest(".dtNode").find("ul li a").attr("aria-selected","false"),e(this).closest("li").addClass("ticked"),e(this).attr("aria-selected","true"),e(this).closest(".dtNode").addClass("done").removeClass("active");h!==a[a.length-1];){var u=a.pop();e("#"+u).slideDown(i.settings.animation_speed,function(){e("#"+u).remove()})}l=i.settings.data_folder+l+"."+i.settings.json_ext,e.ajax(l,{cache:i.settings.cache_json,success:function(t){var d="",l="";if(a.push(c),null!==n){i.settings.question_extra_text&&void 0!==t.description&&(l="<p>"+t.description+"</p>");for(var g=0,h=t.answers.length;h>g;g++)d+="<li><a href='#"+t.answers[g].target+"' aria-selected='false'>"+t.answers[g].text+"</li>";e(o).prepend("<div id='"+a[a.length-1]+"' class='dtNode active'><h3>"+t.question+"</h3>"+l+"<ul>"+d+"</ul></div>")}else s=void 0!==t.image&&i.settings.answer_link&&void 0!==t.link?"<p><a href='"+t.link+"' target='"+i.settings.answer_target+"'><img src='"+t.image+"'></a></p>":void 0!==t.image?"<p><img src='"+t.image+"'></p>":"",r=void 0!==t.link&&i.settings.answer_link?"<h3><a href='"+t.link+"' target='"+i.settings.answer_target+"'>"+t.title+"</a></h3>":"<h3>"+t.title+"</h3>",e(o).prepend("<div id='"+a[a.length-1]+"' class='dtNode answerNode'>"+r+s+t.description+"</div>");e(o).find("#"+a[a.length-1]).hide().slideDown(i.settings.animation_speed)},error:function(){alert("Couldn't retrieve data file: "+l)}})})});var d=function(){var e=Date.now().toString().substr(5);return e="dtn-"+e}})}}(jQuery);